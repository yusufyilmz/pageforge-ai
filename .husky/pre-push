#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

echo "üéØ PageForge Pre-push Validation..."

# Critical: Block push if example data is found
echo "üîç Checking for example data..."
if grep -r "Selene Yu\|example@email\.com\|placeholder@example\.com" src/ --exclude-dir=node_modules 2>/dev/null; then
  echo "‚ùå CRITICAL: Example data found in source code"
  echo "Please remove example data before pushing"
  exit 1
fi

# TypeScript type checking
echo "üîß Running TypeScript type check..."
npm run type-check

# PageForge hierarchy validation
echo "üéØ Validating PageForge development hierarchy..."
TEMPLATE_USAGE=$(grep -r "developerTemplate\|designerTemplate\|freelancerTemplate" src/ --exclude-dir=node_modules 2>/dev/null | wc -l)
PAGEBUILDER_USAGE=$(grep -r "PageBuilder\.create" src/ --exclude-dir=node_modules 2>/dev/null | wc -l)
LEGACY_USAGE=$(grep -r "pageConfigurations\.tsx" src/ --exclude-dir=node_modules 2>/dev/null | wc -l)

if [ "$LEGACY_USAGE" -gt 0 ]; then
  echo "‚ö†Ô∏è Warning: Legacy pageConfigurations.tsx usage detected"
  echo "Consider migrating to Templates ‚Üí TemplateBuilder ‚Üí PageBuilder hierarchy"
fi

if [ "$PAGEBUILDER_USAGE" -gt "$TEMPLATE_USAGE" ]; then
  echo "üí° Suggestion: More PageBuilder than Template usage detected"
  echo "Consider using Templates first for 98% code reduction"
fi

# Once UI compliance check
CUSTOM_BASIC_UI=$(grep -r "const.*Button.*=.*button\|const.*Flex.*=.*div" src/components/ --exclude-dir=node_modules 2>/dev/null | wc -l)
if [ "$CUSTOM_BASIC_UI" -gt 0 ]; then
  echo "‚ö†Ô∏è Warning: Custom basic UI components found"
  echo "Consider using Once UI components instead"
fi

echo "‚úÖ PageForge pre-push validation completed"
