name: 'Notify Results'
description: 'Send notifications about CI/CD workflow results'

inputs:
  workflow-name:
    description: 'Name of the workflow'
    required: false
    default: 'CI/CD Pipeline'
  quality-result:
    description: 'Quality job result (success/failure)'
    required: false
    default: 'success'
  security-result:
    description: 'Security job result (success/failure)'
    required: false
    default: 'success'
  performance-result:
    description: 'Performance job result (success/failure)'
    required: false
    default: 'success'
  supabase-result:
    description: 'Supabase job result (success/failure)'
    required: false
    default: 'success'
  deployment-url:
    description: 'Deployment URL if available'
    required: false
    default: ''

runs:
  using: 'composite'
  steps:
    - name: ðŸ“Š Generate Results Summary
      shell: bash
      run: |
        echo "ðŸ“Š Generating workflow results summary..."

        WORKFLOW_NAME="${{ inputs.workflow-name }}"
        QUALITY="${{ inputs.quality-result }}"
        SECURITY="${{ inputs.security-result }}"
        PERFORMANCE="${{ inputs.performance-result }}"
        SUPABASE="${{ inputs.supabase-result }}"
        DEPLOY_URL="${{ inputs.deployment-url }}"

        # Generate status icons
        get_status_icon() {
          case $1 in
            "success") echo "âœ…" ;;
            "failure") echo "âŒ" ;;
            "cancelled") echo "â¹ï¸" ;;
            "skipped") echo "â­ï¸" ;;
            *) echo "â“" ;;
          esac
        }

        # Create summary
        cat > workflow-summary.md << EOF
        # ðŸš€ $WORKFLOW_NAME Results

        ## ðŸ“Š Job Status Overview

        | Job | Status | Result |
        |-----|--------|--------|
        | **Quality** | $(get_status_icon $QUALITY) | $QUALITY |
        | **Security** | $(get_status_icon $SECURITY) | $SECURITY |
        | **Performance** | $(get_status_icon $PERFORMANCE) | $PERFORMANCE |
        | **Supabase** | $(get_status_icon $SUPABASE) | $SUPABASE |

        ## ðŸ“ˆ Summary
        - **Workflow**: $WORKFLOW_NAME
        - **Completed**: $(date)
        - **Commit**: ${{ github.sha }}
        $(if [ -n "$DEPLOY_URL" ]; then echo "- **Deployment**: $DEPLOY_URL"; fi)

        ## ðŸŽ¯ Next Steps
        - Review any failed jobs above
        - Check PageForge template usage patterns
        - Validate Once UI component integration
        - Ensure no example data in production
        EOF

    - name: ðŸ“¢ Output Summary
      shell: bash
      run: |
        echo "ðŸ“¢ Workflow Results Summary:"
        cat workflow-summary.md

    - name: ðŸ“ Add to Job Summary
      shell: bash
      run: |
        echo "ðŸ“ Adding results to GitHub job summary..."
        cat workflow-summary.md >> $GITHUB_STEP_SUMMARY

    - name: ðŸŽ‰ Success Celebration
      if: inputs.quality-result == 'success' && inputs.security-result == 'success' && inputs.performance-result == 'success' && inputs.supabase-result == 'success'
      shell: bash
      run: |
        echo "ðŸŽ‰ All checks passed! PageForge CI/CD pipeline completed successfully!"
        echo "âœ¨ Ready for deployment with:"
        echo "   - Quality: âœ… Passed"
        echo "   - Security: âœ… Passed"
        echo "   - Performance: âœ… Passed"
        echo "   - Supabase: âœ… Passed"
